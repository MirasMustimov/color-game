<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="description" content="Miggi Color Game is a little game where you have to find cards with matching color name and background.">
<title>Color Game</title>
<link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
<style>
    body {
        background-color: #DFDBE5;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='4' viewBox='0 0 4 4'%3E%3Cpath fill='%239C92AC' fill-opacity='0.4' d='M1 3h1v1H1V3zm2-2h1v1H3V1z'%3E%3C/path%3E%3C/svg%3E");
    }
</style>
</head>
<body>
    <div x-data="game()" x-init="start" class="flex h-screen justify-center items-center">
        <div>
            <h1 class="text-xl font-bold text-center mb-3">
                <span class="text-purple-500">M</span><span class="text-indigo-500">i</span><span class="text-pink-500">g</span><span class="text-pink-500">g</span><span class="text-purple-500">i</span><span class="text-pink-500"> </span><span class="text-blue-500">C</span><span class="text-red-500">o</span><span class="text-purple-500">l</span><span class="text-orange-500">o</span><span class="text-gray-500">r</span><span class="text-yellow-500"> </span><span class="text-blue-500">G</span><span class="text-purple-500">a</span><span class="text-red-500">m</span><span class="text-indigo-500">e</span>
            </h1>

            <div
                x-text="displayTimer"
                class="text-5xl font-semibold text-center mb-4"
                :class="'text-' + randomColor() + '-500'"
            ></div>
            <div class="flex flex-wrap justify-center mb-4" style="width: 30rem;">
                <template x-for="(card, index) in cards">
                    <button
                        type="button"
                        x-text="card.displayColor"
                        class="flex items-center justify-center w-24 h-24 text-white uppercase tracking-wide font-semibold"
                        :class="[ 'bg-' + card.actualColor + '-500', levelAnimationClass ]"
                        :key="index"
                        @click="select(card)"
                    ></button>
                </template>
            </div>
            <div
                x-text="'Score: ' + score"
                class="text-2xl font-semibold text-center text-pink-500 mb-4"
            ></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/collect.js/4.28.2/collect.js"></script>
    <script>
        function game() {
            return {
                tick: null,
                timerLimit: 7,
                timer: 1,
                
                playing: false,
                score: 0,
                
                colors: [ 'gray', 'red', 'orange', 'yellow', 'green', 'teal', 'blue', 'indigo', 'purple', 'pink' ], // colors provided by tailwind css
                cards: [],
                cardQuantity: 25,
                
                start() {
                    this.playing = true
                    this.score = 0
                    
                    this.changeColors()
                    
                    this.timer = 1
                    this.tick = setInterval(() => {
                        (this.timer == this.timerLimit) ? this.gameOver() : this.timer++
                    }, 1000)
                },

                get displayTimer() {
                    return (this.timerLimit + 1) - this.timer
                },

                get levelAnimationClass() {
                    if (this.score >= 10) {
                        return 'animate-bounce'
                    }

                    if (this.score >= 20) {
                        return 'animate-spin'
                    }

                    return ''
                },
                
                select(card) {
                    if (! this.playing) {
                        return
                    }
                    
                    if (card.displayColor == card.actualColor) {
                        this.timer = 1
                        this.score++
                        this.changeColors()
                    }
                },
            
                changeColors() {
                    let color = this.randomColor()
                    let correctColor = {
                        actualColor: color,
                        displayColor: color
                    }
                
                    this.cards = collect()
                        .times((this.cardQuantity - 1), () => {
                            return {
                                actualColor: this.randomColor(),
                                displayColor: this.randomColor()
                            }
                        })
                        .push(correctColor)
                        .shuffle()
                        .all()
                },
            
                randomColor() {
                    return collect(this.colors).random()
                },
                
                gameOver() {
                    this.playing = false
                
                    clearInterval(this.tick)
                
                    if (confirm(`Game Over. Your score is ${this.score}. Want to restart?`)) {
                        this.start()
                    }
                }
            }
        }
    </script>
</body>
</html>
